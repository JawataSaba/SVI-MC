################################################################################
# Step 1: Load Necessary Libraries
################################################################################
library(dplyr)

################################################################################
# Step 2: Set Working Directory and Read Data
################################################################################
setwd("C:\\Users\\jsaba\\Desktop\\Paper 1")
# Read the RPL Rank data from CSV.
data <- read.csv("C:\\Users\\jsaba\\Desktop\\Paper 1\\RPL_rank_df.csv")

################################################################################
# Step 3: Define Function to Calculate Statistics and Entropy Measures
################################################################################
calculate_statistics <- function(df) {
  df %>%
    rowwise() %>%
    mutate(
      # Basic statistics across columns X1 to X10000.
      Ash_Mean = mean(c_across(X1:X10000), na.rm = TRUE),
      Ash_SD = sd(c_across(X1:X10000), na.rm = TRUE),
      Z_Score_Ash = 1.645,
      MoE_Ash = ifelse(!is.na(Ash_SD), 1.645 * (Ash_SD / sqrt(sum(!is.na(c_across(X1:X10000))))), NA),
      CV_Ash = ifelse(Ash_Mean != 0, (Ash_SD / Ash_Mean) * 100, NA),
      
      # Count, Proportion, Zero Flag, and Expected Info for different ranges
      # For the 80-100% range.
      Count_80_100 = sum(c_across(X1:X10000) > 0.799999, na.rm = TRUE),
      Proportion_80_100 = Count_80_100 / 10000,
      Zero_Flag_80_100 = ifelse(Count_80_100 == 0, 1, 0),
      Expected_Info_80_100 = ifelse(Proportion_80_100 == 0, 0, Proportion_80_100 * log(Proportion_80_100, 2)),
      
      # For the 60-80% range.
      Count_60_80 = sum(c_across(X1:X10000) > 0.599999 & c_across(X1:X10000) < 0.8, na.rm = TRUE),
      Proportion_60_80 = Count_60_80 / 10000,
      Zero_Flag_60_80 = ifelse(Count_60_80 == 0, 1, 0),
      Expected_Info_60_80 = ifelse(Proportion_60_80 == 0, 0, Proportion_60_80 * log(Proportion_60_80, 2)),
      
      # For the 40-60% range.
      Count_40_60 = sum(c_across(X1:X10000) > 0.399999 & c_across(X1:X10000) < 0.6, na.rm = TRUE),
      Proportion_40_60 = Count_40_60 / 10000,
      Zero_Flag_40_60 = ifelse(Count_40_60 == 0, 1, 0),
      Expected_Info_40_60 = ifelse(Proportion_40_60 == 0, 0, Proportion_40_60 * log(Proportion_40_60, 2)),
      
      # For the 20-40% range.
      Count_20_40 = sum(c_across(X1:X10000) > 0.199999 & c_across(X1:X10000) < 0.4, na.rm = TRUE),
      Proportion_20_40 = Count_20_40 / 10000,
      Zero_Flag_20_40 = ifelse(Count_20_40 == 0, 1, 0),
      Expected_Info_20_40 = ifelse(Proportion_20_40 == 0, 0, Proportion_20_40 * log(Proportion_20_40, 2)),
      
      # For the 0-20% range.
      Count_0_20 = sum(c_across(X1:X10000) < 0.2, na.rm = TRUE),
      Proportion_0_20 = Count_0_20 / 10000,
      Zero_Flag_0_20 = ifelse(Count_0_20 == 0, 1, 0),
      Expected_Info_0_20 = ifelse(Proportion_0_20 == 0, 0, Proportion_0_20 * log(Proportion_0_20, 2)),
      
      # Entropy Calculations based on quintile ranges.
      Quintile_Entropy = -sum(c(Expected_Info_80_100, Expected_Info_60_80, Expected_Info_40_60, Expected_Info_20_40, Expected_Info_0_20), na.rm = TRUE),
      Normalized_Quintile_Entropy = Quintile_Entropy / log(5, 2),
      
      # Count, Proportion, Zero Flag, and Expected Info for 90-100 range
      Count_90_100 = sum(c_across(X1:X10000) > 0.899999, na.rm = TRUE),
      Proportion_90_100 = Count_90_100 / 10000,
      Zero_Flag_90_100 = ifelse(Count_90_100 == 0, 1, 0),
      Expected_Info_90_100 = ifelse(Proportion_90_100 == 0, 0, Proportion_90_100 * log(Proportion_90_100, 2)),
      
      # Count, Proportion, Zero Flag, and Expected Info for 0-90 range
      Count_0_90 = sum(c_across(X1:X10000) < 0.9, na.rm = TRUE),
      Proportion_0_90 = Count_0_90 / 10000,
      Zero_Flag_0_90 = ifelse(Count_0_90 == 0, 1, 0),
      Expected_Info_0_90 = ifelse(Proportion_0_90 == 0, 0, Proportion_0_90 * log(Proportion_0_90, 2)),
      
      # Flag Entropy Calculation
      Flag_Entropy = -sum(c(Expected_Info_90_100, Expected_Info_0_90), na.rm = TRUE)
    )
}

################################################################################
# Step 4: Apply the Function and Save the Results
################################################################################
# Apply the function to the data
result <- calculate_statistics(data)
# Save the result to a new CSV file
write.csv(result, "C:/Users/jsaba/Desktop/Paper 1/Overall_Entropy.csv", row.names = FALSE)
